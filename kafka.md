# Kafka

Брокер сообщений - отдельная программа, которая сохраняет данные пришедшие от продюсера и при запросе консьюмера отдаёт ещё не обработанные данные, тем самым гарантируя то, что данные обязательно будут доставлены консьюмеру  
Topic - тема сообщений, которую создаёт сам разработчик, куда будут приходить данные только определённого типа  

Сам topic разделяется на partitions в которые данны попадают случайным образом. Из-за этого данные приходят в консьюмер не последовательно. Это можно сделать, добавив в сообщение определённый key. При этом различные partition одного топика, можно распределить на разные сервера сохраняя копии этих partition на прежнем сервере и всегда дублируя отправку этих данных, но консьюмер будет забирать данные с основного сервера. Это нужно для того, чтобы максимально обезопасить данные от потери

Как брокер, Kafka предоставляет гарантии доставки сообщений:
* At Most Once - (максимум один раз) гарантия, при которой сообщение может прийти только раз, а может и не прийти вовсе, больше подходит для данных, потеря которых либо не отразится, либо отразится незначительно. Более лучшим аналогом является Redis
* At Least Once - (как минимум один раз) гарантия, при которой сообщение будет доставлено один раз, но может быть и больше. После отправки сообщение продюсер будет ждать подтверждения (acknowledgment) от Kafka. что данные получены и он может продолжить работу. Если данные не были получены, продюсер будет посылать данные до тех пор, пока не получит подтверждение о том, что данные были получены. При этом сценарии может происходить дублирование данных, но хотя бы раз они точно будут доставлены

Идемпотентный (консьюмер) - является идемпотентным в той ситуации, когда в нём есть логика, которая позволяет ему работать с дубликатами так, как будто это было всегда одно сообщение. Способов для этого существует много, как вариант, проверять в базе двннх 

Для того, чтобы данные с Kafka не были потеряны по физическим причинам, создают несколько серверов с Kafka и объединяют их в кластеры. Это называется **репликацией** и по такому принципу должны работать все микросервисы
